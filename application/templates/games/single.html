{% extends "layout.html" %}
{% block body %}
<div class="container">
    <div class="row">
        <div class="col-sm">
            <h1>
                {{ game.name }} ({{ game.year }})
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('games_modify', game_id=game.id) }}">
                        <button class="btn btn-secondary btn-sm">Muokkaa pelin tietoja</button>
                    </a>
                {% endif %}
            </h1> 

            
                <h4>Kehittäjä: {{ game.developer }}</h4>
            

            
            <div class="container">
                {{ game.description }}
            </div>

        </div>
        {% if current_user.is_authenticated %}
        <div class="col-sm align-self-center">
                
                {% if current_user.has_reviewed(game.id)%}
                    Olet jo arvioinut
                {% else %}
                    <a href="{{ url_for('reviews_create', game_id=game.id) }}">
                        <button class="btn btn-primary btn-lg btn-block">Arvioi peli</button>
                    </a>
                {% endif %}           
        </div>
        {% endif %}
    </div>
</div>

<div class="container">
<table class="table table-striped">
    <thead class="thead-dark">
        <tr>
            <th>Arvio</th>
            <th>Pistemäärä /10</th>
            <th>Kirjoittaja</th>
            <th>Reagoinnit</th>
            {% if current_user.is_authenticated %}
            <th>Reagoi</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
    {% for review in reviews %}
    <tr>
        <td>{{ review.text }} <a href="{{ url_for('reviews_modify', review_id=review.id) }}"><button class="btn btn-success">Muokkaa arviota</button></a></td>
        <td>{{ review.points }}</td>
        <td>{{ review.account.username }}</td>
        <td>

            {% if reactions[review.id] is defined %}
                <p>Positiivisia:negatiivisia reaktioita: {{ reactions[review.id][0] }}:{{ reactions[review.id][1] }} </p>            
            <div class="progress">
                <div class="progress-bar bg-success" role="progressbar" style="width: {{ reactions[review.id][2] }}%" aria-valuenow="{{ reactions[review.id][2] }}" aria-valuemin="0" aria-valuemax="100"></div>
                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ 100 - reactions[review.id][2] }}%" aria-valuenow="{{ 100 - reactions[review.id][2] }}" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            {% endif %}
        </td>
        {% if current_user.is_authenticated %}
        <td>


        
            {% if current_user.has_reacted(review.id) %}
            Olet jo reagoinut
            {% else %}
            
                <form class="form-inline" method="POST" action="{{ url_for('reactions_create', review_id=review.id) }}">
                    {% for subfield in form.positivity %}
                    
                    <div class="form-group">
                        <!--  Alla oleva värin päättäminen on ehkä aika hack, sillä se perustuu täysin ReactionFormin rakenteeseen. 
                              Jos ko. luokkaa muutetaan, joutuu löytämään uuden ratkaisun...   -->
                        <button type="submit" class="btn btn-{{["danger", "success"][subfield.data] }}" value="{{ subfield.data }}" name="{{ subfield.name }}">
                            {{ subfield.label.text }}
                        </button>
                    </div>
                    
                    {% endfor %}
                </form>
            
            {% endif %}
        


        </td>
        {% endif %}
    </tr>
    {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}
