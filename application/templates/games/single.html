{% extends "layout.html" %}
{% block body %}
<div class="container">
    <div class="row">
        <div class="col-sm">
            <h1>{{ game.name }} ({{ game.year }})</h1> 

            <ul>
                <li>Kehittäjä: {{ game.developer }}</li>
            </ul>

            
            <div class="container">
                {{ game.description }}
            </div>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('games_modify', game_id=game.id) }}">Muokkaa pelin tietoja </a>
            {% endif %}
        </div>

        <div class="col-sm align-self-center">
            {% if current_user.is_authenticated %}    
                {% if current_user.has_reviewed(game.id)%}
                    Olet jo arvioinut
                {% else %}
                    <a href="{{ url_for('reviews_create', game_id=game.id) }}">
                        <button class="btn btn-primary btn-lg btn-block">Arvioi peli</button>
                    </a>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
<div class="container">
<table class="table table-striped">
    <thead class="thead-dark">
        <tr>
            <th>Arvio</th>
            <th>Pistemäärä /10</th>
            <th>Kirjoittaja</th>
            <th>Reagoinnnit</th>
            {% if current_user.is_authenticated %}
            <th>Reagoi</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
    {% for review in reviews %}
    <tr>
        <td>{{ review.text }}</td>
        <td>{{ review.points }}</td>
        <td>{{ review.account.username }}</td>
        <td>
            {% if reactions[review.id] is defined %}
                <p>Positiivisia/negatiivisia reaktioita: {{ reactions[review.id][0] }}/{{ reactions[review.id][1] }} </p>
            {% endif %}
        </td>
        {% if current_user.is_authenticated %}
        <td>


        
            {% if current_user.has_reacted(review.id) %}
            Olet jo reagoinut
            {% else %}
            
                <form class="form-inline" method="POST" action="{{ url_for('reactions_create', review_id=review.id) }}">
                    {% for subfield in form.positivity %}
                    
                    <div class="form-group">
                        <!--  Alla oleva värin päättäminen on ehkä aika hack, sillä se perustuu täysin ReactionFormin rakenteeseen. 
                              Jos ko. luokkaa muutetaan, joutuu löytämään uuden ratkaisun...   -->
                        <button type="submit" class="btn btn-{{["danger", "success"][subfield.data] }}" value="{{ subfield.data }}" name="{{ subfield.name }}">
                            {{ subfield.label.text }}
                        </button>
                    </div>
                    
                    {% endfor %}
                </form>
            
            {% endif %}
        


        </td>
        {% endif %}
    </tr>
    {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}
